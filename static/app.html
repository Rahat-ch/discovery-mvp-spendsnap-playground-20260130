<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MCP App UI (Iframe)</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; padding: 12px; }
      .card { border: 1px solid rgba(127,127,127,0.25); border-radius: 10px; padding: 12px; }
      h1 { font-size: 14px; margin: 0 0 8px; }
      p { margin: 6px 0; opacity: 0.85; font-size: 12px; }
      pre { margin: 10px 0 0; padding: 10px; border-radius: 8px; background: rgba(127,127,127,0.08); overflow: auto; font-size: 12px; }
      button { margin-top: 10px; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(127,127,127,0.35); background: transparent; cursor: pointer; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>UI sandbox</h1>
      <p>
        This iframe simulates an <strong>MCP App</strong> rendering inline in a host.
        It receives tool data via <code>postMessage</code> and can send UI events back.
      </p>
      <button id="ping">Send UI event to host</button>
      <pre id="data">(waiting for host...)</pre>
    </div>

    <script>
      const pre = document.getElementById("data");
      const btn = document.getElementById("ping");

      let lastData = null;

      function send(type, payload) {
        window.parent.postMessage({ type: "mcp:ui_event", event: type, payload }, "*");
      }

      window.addEventListener("message", (event) => {
        if (!event.data || typeof event.data !== "object") return;
        if (event.data.type === "mcp:tool_data") {
          lastData = event.data.data;
          pre.textContent = JSON.stringify(lastData, null, 2);
          send("received_tool_data", { ok: true, keys: Object.keys(lastData || {}) });
        }
      });

      btn.addEventListener("click", () => {
        send("button_clicked", {
          at: new Date().toISOString(),
          note: "In a real MCP App, this could request another tool call via the host bridge.",
          lastTool: lastData?.tool || null
        });
      });

      send("ui_ready", { ts: new Date().toISOString() });
    </script>
  </body>
</html>
